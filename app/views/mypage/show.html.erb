<% if current_user.children.empty? %>
  <%= link_to 'お子様の情報を登録', new_child_path, class: 'px-3 py-2 text-white bg-amber-vivid rounded-md' %>
<% else %>
  <% if @child.plans.present? %>
    <div class='w-2/3 rounded-lg border border-yellow-200 text-amber-dark bg-yellow-200 p-4 m-auto'>
      <div class='flex justify-between mb-3'>
        <h1 class='text-3xl text-amber-dark'><%= Date.today.year %>年<%= Date.today.month %>月</h1>
        <%= link_to '入 金', new_child_payment_collection_path(@child.id), class: 'px-10 py-1 bg-amber-vivid text-white text-md text-align-center rounded-md shadow-md hover:shadow-sm' %>
      </div>
      <table class='w-full m-auto'>
        <tbody>
          <% @child.plans.each do |plan| %>
            <tr>
              <td class='w-1/3 text-amber-dark text-left pb-2'><%= plan.item %></td>
              <td class='w-1/3 text-amber-dark text-center pb-2'><%= plan.amount.to_s(:delimited) %>円</td>
              <td class='w-1/3 text-amber-dark text-right pb-2'><%= plan.payment_day %>日入金予定</td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <hr class='border-amber-dark'>
      <p class='text-amber-dark text-center text-lg font-bold mt-2'><%= @child.plans.sum(:amount).to_s(:delimited) %>円</p>
    </div>
  <% end %>

  <% if @child.payments.present? %>
    <div class='flex justify-center mt-5'>
      <div class='w-1/3'>
        <%= react_component('features/PieChart', { items: @savings_datas.keys, amounts: @savings_datas.values }) %>
      </div>
      <div class='w-1/2 text-center text-amber-dark bg-yellow-100 rounded-lg'>
        <div>
          <p class='mt-5 text-4xl'><%= @savings_datas.values.sum.to_s(:delimited) %></p>
          <p class='text-sm'>積立予定額：　<%= @child.estimated_amount.to_s(:delimited) %></p>
        </div>
        <div class='mt-10'>
          <p class="text-3xl text-<%= @child.diff_amount.negative? ? 'red-500' : 'green-500' %>"><%= '+' if @child.diff_amount.positive? %><%= @child.diff_amount.to_s(:delimited) %></p>
          <div>
            <% if @child.diff_amount.negative? && @child.diff_amount < -100000 %>
              <p>計画の見直しを検討してください。</p>
              <div class='mt-3'>
                <%= link_to '計画を見直す', '#', class: 'px-3 py-2 bg-green-300 text-white rounded-lg shadow-md hover:shadow-sm' %>
              </div>
            <% elsif @child.diff_amount.positive? && @child.diff_amount > 100000 %>
              <p>余裕があるので、もう少し家計優先でもいいかも？</p>
              <div class='mt-3'>
                <%= link_to '計画を見直す', '#', class: 'px-3 py-2 bg-green-300 text-white rounded-lg shadow-md hover:shadow-sm' %>
              </div>
            <% else %>
              <p>概ね計画通りです。このまま頑張りましょう。</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <p class='text-center text-amber-dark'>データはありません</p>
  <% end %>
  <% if @child.result.present? %>
      <div class='mb-10'>
        <%= render 'event', child: @child, event: '高校入学', event_sym: :high_school_cost, age: 15, image: 'high_school.png' %>
        <%= render 'event', child: @child, event: '大学入学', event_sym: :university_cost, age: 18, image: 'university.png' %>
      </div>
    <% else %>
      <div class='my-10 text-center'>
        <p class='mb-3 text-amber-dark text-sm'>希望進路を登録すると、高校や大学進学時に必要な額が貯められるかを確認できます。</p>
        <%= link_to '希望進路を登録する', '#', class: 'px-3 py-2 bg-amber-vivid text-white rounded-md shadow-md hover:shadow-sm' %>
      </div>
    <% end %>
<% end %>